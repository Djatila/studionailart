<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico de Dados do Cliente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background-color: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .result {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            margin: 5px 0;
        }
        .form-group {
            margin: 15px 0;
        }
        .appointment-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico de Dados do Cliente</h1>
        <p>Esta ferramenta ajuda a identificar por que os dados do cliente n√£o est√£o sendo carregados automaticamente.</p>
        
        <div class="form-group">
            <label>ID do Cliente:</label>
            <input type="text" id="clientId" value="cliente-teste-123" placeholder="ID do cliente">
        </div>
        
        <div class="form-group">
            <label>Nome do Cliente:</label>
            <input type="text" id="clientName" value="Maria Silva" placeholder="Nome do cliente">
        </div>
        
        <div class="form-group">
            <label>Telefone do Cliente:</label>
            <input type="text" id="clientPhone" value="(11) 99999-9999" placeholder="Telefone do cliente">
        </div>
        
        <div class="form-group">
            <label>Email do Cliente:</label>
            <input type="text" id="clientEmail" value="maria@teste.com" placeholder="Email do cliente">
        </div>
        
        <button onclick="simulateClientLogin()">üë§ Simular Login do Cliente</button>
        <button onclick="testBookingPage()">üìã Testar P√°gina de Agendamento</button>
        <button onclick="clearLog()">üóëÔ∏è Limpar Log</button>
        
        <div id="log" class="log"></div>
        <div id="result"></div>
    </div>

    <script>
        // Vari√°vel para armazenar os dados do cliente logado
        let loggedClient = null;
        
        // Fun√ß√£o para registrar logs
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Tamb√©m mostrar no console
            console.log(`[${timestamp}] ${message}`);
        }
        
        // Fun√ß√£o para mostrar resultado
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        // Fun√ß√£o para simular login do cliente
        function simulateClientLogin() {
            const clientId = document.getElementById('clientId').value;
            const clientName = document.getElementById('clientName').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const clientEmail = document.getElementById('clientEmail').value;
            
            loggedClient = {
                id: clientId,
                name: clientName,
                phone: clientPhone,
                email: clientEmail,
                password: 'senha123',
                isActive: true,
                createdAt: new Date().toISOString()
            };
            
            log('üë§ Cliente logado simulado:', 'info');
            log(JSON.stringify(loggedClient, null, 2), 'info');
            showResult('‚úÖ Cliente logado simulado com sucesso', 'success');
        }
        
        // Fun√ß√£o auxiliar para formatar o n√∫mero de telefone
        function formatPhoneNumber(phoneNumber) {
            if (!phoneNumber) return '';
            
            // Remove todos os caracteres n√£o num√©ricos
            let cleaned = phoneNumber.replace(/\D/g, '');
            
            // Se o n√∫mero come√ßar com 55 (c√≥digo do Brasil), removemos
            if (cleaned.startsWith('55')) {
                cleaned = cleaned.substring(2);
            }
            
            // Formata para o padr√£o brasileiro (XX) XXXXX-XXXX
            if (cleaned.length >= 10) {
                // Se for um n√∫mero de celular (11 d√≠gitos) ou telefone fixo (10 d√≠gitos)
                if (cleaned.length === 11) {
                    // Formato para celular: (XX) XXXXX-XXXX
                    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 7)}-${cleaned.substring(7, 11)}`;
                } else if (cleaned.length === 10) {
                    // Formato para telefone fixo: (XX) XXXX-XXXX
                    return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6, 10)}`;
                }
            }
            
            // Se n√£o tiver o tamanho esperado, retorna o n√∫mero limpo
            return cleaned;
        }
        
        // Fun√ß√£o para simular o useEffect que preenche os dados do cliente
        function simulateUseEffect() {
            log('üîç useEffect loggedClient chamado. loggedClient:', 'info');
            log(JSON.stringify(loggedClient, null, 2), 'info');
            
            if (loggedClient) {
                log('üë§ Cliente logada detectada:', 'info');
                log(`üìù Nome do cliente: ${loggedClient.name}`, 'info');
                log(`üìû Telefone do cliente: ${loggedClient.phone}`, 'info');
                
                // Simular preenchimento dos campos
                const clientName = loggedClient.name || '';
                const clientPhone = formatPhoneNumber(loggedClient.phone || '');
                const clientEmail = loggedClient.email || '';
                
                log(`‚úÖ Campos preenchidos - Nome: "${clientName}", Telefone: "${clientPhone}", Email: "${clientEmail}"`, 'success');
                return { clientName, clientPhone, clientEmail };
            } else {
                log('‚ö†Ô∏è Nenhum cliente logado detectado', 'error');
                return { clientName: '', clientPhone: '', clientEmail: '' };
            }
        }
        
        // Fun√ß√£o para testar a p√°gina de agendamento
        function testBookingPage() {
            if (!loggedClient) {
                log('‚ùå Nenhum cliente logado. Fa√ßa o login primeiro.', 'error');
                showResult('‚ùå Nenhum cliente logado. Fa√ßa o login primeiro.', 'error');
                return;
            }
            
            log('üìã Testando p√°gina de agendamento...', 'info');
            
            // Simular o useEffect
            const { clientName, clientPhone, clientEmail } = simulateUseEffect();
            
            // Verificar se os campos est√£o preenchidos
            const isNameValid = clientName && clientName.trim() !== '';
            const isPhoneValid = clientPhone && clientPhone.trim() !== '';
            
            log(`üìù Nome v√°lido: ${isNameValid}`, 'info');
            log(`üìû Telefone v√°lido: ${isPhoneValid}`, 'info');
            
            // Simular a condi√ß√£o do bot√£o: disabled={!clientName || !clientPhone}
            const isButtonDisabled = !isNameValid || !isPhoneValid;
            
            if (isButtonDisabled) {
                log('üö´ Bot√£o estaria desabilitado!', 'error');
                showResult('üö´ Bot√£o de agendamento estaria desabilitado - campos obrigat√≥rios n√£o preenchidos', 'error');
            } else {
                log('‚úÖ Bot√£o estaria habilitado!', 'success');
                showResult('‚úÖ Bot√£o de agendamento estaria habilitado', 'success');
            }
        }
        
        // Fun√ß√£o para limpar o log
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('result').innerHTML = '';
        }
        
        // Executar testes iniciais ao carregar a p√°gina
        window.addEventListener('load', () => {
            log('üîß Ferramenta de diagn√≥stico carregada', 'info');
            log('üìã Esta ferramenta simula o fluxo de login do cliente e verifica√ß√£o de dados no BookingPage', 'info');
        });
    </script>
</body>
</html>